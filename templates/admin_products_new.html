{% extends "admin_base.html" %}

{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª{% endblock %}

{% block extra_css %}
<style>
    /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
    .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
    }
    .stat-card-mini {
        background: var(--card);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        border: 1px solid rgba(108, 92, 231, 0.2);
    }
    .stat-card-mini .stat-number {
        font-size: 28px;
        font-weight: bold;
        color: var(--primary-light);
    }
    .stat-card-mini .stat-label {
        font-size: 13px;
        color: var(--muted);
        margin-top: 5px;
    }
    
    /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    .product-card {
        background: var(--card);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: transform 0.3s;
        border: 1px solid rgba(108, 92, 231, 0.2);
    }
    .product-card:hover { transform: translateY(-5px); }
    .product-card.sold-card { opacity: 0.7; }
    
    .product-image {
        height: 120px;
        background: linear-gradient(135deg, var(--primary), #a29bfe);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        position: relative;
    }
    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .product-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--success);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
    }
    .product-info {
        padding: 15px;
    }
    .product-name {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 8px;
    }
    .product-details {
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 12px;
        min-height: 40px;
    }
    .product-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .product-price {
        font-size: 18px;
        font-weight: bold;
        color: var(--success);
    }
    .delete-btn {
        background: linear-gradient(135deg, var(--danger), #ff7675);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        font-family: 'Tajawal', sans-serif;
        transition: transform 0.2s;
    }
    .delete-btn:hover { transform: scale(1.05); }
    
    /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
    .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.7);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    .modal.active { display: flex; }
    .modal-content {
        background: var(--card);
        border-radius: 16px;
        width: 100%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        border: 1px solid rgba(108, 92, 231, 0.3);
    }
    .modal-header {
        padding: 20px;
        background: linear-gradient(135deg, var(--primary), #a29bfe);
        border-radius: 16px 16px 0 0;
    }
    .modal-header h2 {
        margin: 0;
        font-size: 18px;
    }
    .modal-body {
        padding: 20px;
    }
    .modal-footer {
        padding: 15px 20px;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    /* Ø§Ù„Ø­Ù‚ÙˆÙ„ */
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 10px;
        background: rgba(255,255,255,0.1);
        color: white;
        font-family: 'Tajawal', sans-serif;
        font-size: 14px;
    }
    .form-group textarea {
        min-height: 80px;
        resize: vertical;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--primary);
    }
    .form-group small {
        display: block;
        margin-top: 5px;
        color: var(--muted);
        font-size: 12px;
    }
    
    /* Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ© */
    .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--muted);
    }
    .empty-state .icon {
        font-size: 50px;
        margin-bottom: 15px;
    }
    
    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
    .alert {
        padding: 15px 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        display: none;
    }
    .alert.show { display: block; animation: fadeIn 0.3s; }
    .alert-success { background: rgba(0, 184, 148, 0.2); border: 1px solid var(--success); color: var(--success); }
    .alert-error { background: rgba(231, 76, 60, 0.2); border: 1px solid var(--danger); color: var(--danger); }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .section-title {
        font-size: 16px;
        margin: 20px 0 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--primary);
        display: flex;
        align-items: center;
        gap: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="top-bar">
    <h1>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
    <div class="top-bar-actions">
        <button class="btn btn-primary" onclick="openAddModal()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
        <button class="btn btn-secondary btn-sm" onclick="loadProducts()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
    </div>
</div>

<!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<div id="alertSuccess" class="alert alert-success"></div>
<div id="alertError" class="alert alert-error"></div>

<!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="stats">
    <div class="stat-card-mini">
        <div class="stat-number" id="totalProducts">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
    </div>
    <div class="stat-card-mini">
        <div class="stat-number" id="availableProducts">0</div>
        <div class="stat-label">Ù…ØªØ§Ø­ Ù„Ù„Ø¨ÙŠØ¹</div>
    </div>
    <div class="stat-card-mini">
        <div class="stat-number" id="soldProducts">0</div>
        <div class="stat-label">ØªÙ… Ø¨ÙŠØ¹Ù‡Ø§</div>
    </div>
</div>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© -->
<h2 class="section-title">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
<div id="availableGrid" class="products-grid">
    <div class="loading">
        <div class="spinner"></div>
    </div>
</div>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø© -->
<h2 class="section-title">âœ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</h2>
<div id="soldGrid" class="products-grid">
    <div class="loading">
        <div class="spinner"></div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
<div id="addModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>ğŸ“¦ Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… *</label>
                <select id="productDeliveryType" required onchange="toggleDeliveryFields()">
                    <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ… --</option>
                    <option value="instant">âš¡ ØªØ³Ù„ÙŠÙ… ÙÙˆØ±ÙŠ (Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª)</option>
                    <option value="manual">ğŸ‘¨â€ğŸ’¼ ØªØ³Ù„ÙŠÙ… ÙŠØ¯ÙˆÙŠ (Ø§Ù„Ù…Ø´ØªØ±ÙŠ ÙŠÙƒØªØ¨ Ø·Ù„Ø¨Ù‡)</option>
                </select>
            </div>
            
            <div id="commonFields" style="display: none;">
                <div class="form-group">
                    <label>ğŸ“¦ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
                    <input type="text" id="productName" placeholder="Ù…Ø«Ø§Ù„: Ù†ØªÙÙ„ÙƒØ³ Ø´Ù‡Ø± ÙƒØ§Ù…Ù„" required>
                </div>
                <div class="form-group">
                    <label>ğŸ’° Ø§Ù„Ø³Ø¹Ø± (Ø±ÙŠØ§Ù„) *</label>
                    <input type="number" id="productPrice" placeholder="25" min="1" required>
                </div>
                <div class="form-group">
                    <label>ğŸ·ï¸ Ø§Ù„ÙØ¦Ø© *</label>
                    <select id="productCategory" required>
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ğŸ“ ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <textarea id="productDetails" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ù†ØªØ¬..."></textarea>
                </div>
                <div class="form-group">
                    <label>ğŸ–¼ï¸ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="url" id="productImage" placeholder="https://example.com/image.jpg">
                </div>
            </div>
            
            <div id="instantFields" style="display: none;">
                <div class="form-group" style="background: rgba(46, 204, 113, 0.1); padding: 15px; border-radius: 10px; border: 1px solid rgba(46, 204, 113, 0.3);">
                    <label>ğŸ” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ© (Ø¥ÙŠÙ…ÙŠÙ„/Ø¨Ø§Ø³ÙˆØ±Ø¯) *</label>
                    <textarea id="productHiddenData" placeholder="email@example.com&#10;password123"></textarea>
                    <small>âš¡ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªÙØ±Ø³Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ù…Ø´ØªØ±ÙŠ ÙÙˆØ± Ø§Ù„Ø´Ø±Ø§Ø¡</small>
                </div>
            </div>
            
            <div id="manualFields" style="display: none;">
                <div class="form-group" style="background: rgba(241, 196, 15, 0.1); padding: 15px; border-radius: 10px; border: 1px solid rgba(241, 196, 15, 0.3);">
                    <label>ğŸ“ Ù…Ø§Ø°Ø§ ØªØ­ØªØ§Ø¬ Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠØŸ *</label>
                    <textarea id="productBuyerInstructions" placeholder="Ù…Ø«Ø§Ù„: Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŒ Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨..."></textarea>
                    <small>ğŸ‘¨â€ğŸ’¼ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ø°Ø§ Ù„Ù„Ù…Ø´ØªØ±ÙŠ ÙˆØ³ÙŠÙØ·Ù„Ø¨ Ù…Ù†Ù‡ ÙƒØªØ§Ø¨Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</small>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeAddModal()">Ø¥Ù„ØºØ§Ø¡</button>
            <button class="btn btn-success" onclick="submitProduct()">âœ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
        </div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù -->
<div id="deleteModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
            <h2>ğŸ—‘ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
        </div>
        <div class="modal-body" style="text-align: center;">
            <div style="font-size: 50px; margin-bottom: 15px;">âš ï¸</div>
            <p style="font-size: 16px; margin-bottom: 10px;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ</p>
            <p id="deleteProductName" style="color: var(--danger); font-weight: bold;"></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">Ø¥Ù„ØºØ§Ø¡</button>
            <button class="btn btn-danger" onclick="confirmDelete()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const ADMIN_ID = '{{ admin_id }}';
    let productToDelete = null;
    
    document.addEventListener('DOMContentLoaded', () => {
        loadProducts();
        loadCategoriesForSelect();
    });
    
    async function loadCategoriesForSelect() {
        try {
            const response = await fetch('/api/admin/get_categories');
            const data = await response.json();
            
            if(data.status === 'success') {
                const select = document.getElementById('productCategory');
                select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© --</option>';
                data.categories.forEach(cat => {
                    select.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
                });
            }
        } catch(error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:', error);
        }
    }
    
    async function loadProducts() {
        try {
            const response = await fetch('/api/admin/get_products');
            const data = await response.json();
            
            if(data.status === 'success') {
                renderProducts(data.available, data.sold);
                updateStats(data.available.length, data.sold.length);
            } else {
                showAlert('error', 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª');
            }
        } catch(error) {
            showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
        }
    }
    
    function renderProducts(available, sold) {
        const availableGrid = document.getElementById('availableGrid');
        const soldGrid = document.getElementById('soldGrid');
        
        if(available.length === 0) {
            availableGrid.innerHTML = `
                <div class="empty-state" style="grid-column: 1/-1;">
                    <div class="icon">ğŸ“¦</div>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            `;
        } else {
            availableGrid.innerHTML = available.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        ${product.image_url ? `<img src="${product.image_url}" alt="${product.item_name}">` : 'ğŸ'}
                        ${product.category ? `<span class="product-badge">${product.category}</span>` : ''}
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.item_name}</div>
                        <div class="product-details">${product.details || 'Ø¨Ø¯ÙˆÙ† ØªÙØ§ØµÙŠÙ„'}</div>
                        <div class="product-footer">
                            <span class="product-price">${product.price} Ø±ÙŠØ§Ù„</span>
                            <button class="delete-btn" onclick="openDeleteModal('${product.id}', '${product.item_name.replace(/'/g, "\\'")}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        if(sold.length === 0) {
            soldGrid.innerHTML = `
                <div class="empty-state" style="grid-column: 1/-1;">
                    <div class="icon">ğŸ›’</div>
                    <p>Ù„Ù… ÙŠØªÙ… Ø¨ÙŠØ¹ Ø£ÙŠ Ù…Ù†ØªØ¬ Ø¨Ø¹Ø¯</p>
                </div>
            `;
        } else {
            soldGrid.innerHTML = sold.map(product => `
                <div class="product-card sold-card">
                    <div class="product-image">
                        ${product.image_url ? `<img src="${product.image_url}" alt="${product.item_name}" style="filter: grayscale(50%);">` : 'ğŸ'}
                        ${product.category ? `<span class="product-badge" style="background: #e74c3c;">${product.category}</span>` : ''}
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.item_name}</div>
                        <div class="product-details">
                            ${product.buyer_name ? `ğŸ‰ Ø§Ù„Ù…Ø´ØªØ±ÙŠ: ${product.buyer_name}` : ''}
                        </div>
                        <div class="product-footer">
                            <span class="product-price" style="text-decoration: line-through; color: #888;">${product.price} Ø±ÙŠØ§Ù„</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    }
    
    function updateStats(available, sold) {
        document.getElementById('totalProducts').textContent = available + sold;
        document.getElementById('availableProducts').textContent = available;
        document.getElementById('soldProducts').textContent = sold;
    }
    
    function toggleDeliveryFields() {
        const deliveryType = document.getElementById('productDeliveryType').value;
        const commonFields = document.getElementById('commonFields');
        const instantFields = document.getElementById('instantFields');
        const manualFields = document.getElementById('manualFields');
        
        if(deliveryType === '') {
            commonFields.style.display = 'none';
            instantFields.style.display = 'none';
            manualFields.style.display = 'none';
        } else if(deliveryType === 'instant') {
            commonFields.style.display = 'block';
            instantFields.style.display = 'block';
            manualFields.style.display = 'none';
        } else if(deliveryType === 'manual') {
            commonFields.style.display = 'block';
            instantFields.style.display = 'none';
            manualFields.style.display = 'block';
        }
    }
    
    function openAddModal() {
        document.getElementById('addModal').classList.add('active');
    }
    
    function closeAddModal() {
        document.getElementById('addModal').classList.remove('active');
        document.getElementById('productDeliveryType').value = '';
        document.getElementById('productName').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productCategory').value = '';
        document.getElementById('productDetails').value = '';
        document.getElementById('productHiddenData').value = '';
        document.getElementById('productBuyerInstructions').value = '';
        document.getElementById('productImage').value = '';
        document.getElementById('commonFields').style.display = 'none';
        document.getElementById('instantFields').style.display = 'none';
        document.getElementById('manualFields').style.display = 'none';
    }
    
    async function submitProduct() {
        const deliveryType = document.getElementById('productDeliveryType').value;
        const name = document.getElementById('productName').value.trim();
        const price = document.getElementById('productPrice').value;
        const category = document.getElementById('productCategory').value;
        const details = document.getElementById('productDetails').value.trim();
        const image = document.getElementById('productImage').value.trim();
        
        if(!deliveryType) {
            showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…');
            return;
        }
        
        if(!name || !price || !category) {
            showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
            return;
        }
        
        let hiddenData = '';
        let buyerInstructions = '';
        
        if(deliveryType === 'instant') {
            hiddenData = document.getElementById('productHiddenData').value.trim();
            if(!hiddenData) {
                showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ© Ù„Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙÙˆØ±ÙŠ');
                return;
            }
        } else if(deliveryType === 'manual') {
            buyerInstructions = document.getElementById('productBuyerInstructions').value.trim();
            if(!buyerInstructions) {
                showAlert('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙŠ');
                return;
            }
        }
        
        try {
            const response = await fetch('/api/admin/add_product_new', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: name,
                    price: parseFloat(price),
                    category: category,
                    details: details,
                    hidden_data: hiddenData,
                    buyer_instructions: buyerInstructions,
                    image: image,
                    delivery_type: deliveryType
                })
            });
            
            const data = await response.json();
            
            if(data.status === 'success') {
                showAlert('success', 'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
                closeAddModal();
                loadProducts();
            } else {
                showAlert('error', data.message || 'ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬');
            }
        } catch(error) {
            showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
        }
    }
    
    function openDeleteModal(productId, productName) {
        productToDelete = productId;
        document.getElementById('deleteProductName').textContent = productName;
        document.getElementById('deleteModal').classList.add('active');
    }
    
    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
        productToDelete = null;
    }
    
    async function confirmDelete() {
        if(!productToDelete) return;
        
        try {
            const response = await fetch('/api/admin/delete_product', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ product_id: productToDelete })
            });
            
            const data = await response.json();
            
            if(data.status === 'success') {
                showAlert('success', 'âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
                closeDeleteModal();
                loadProducts();
            } else {
                showAlert('error', data.message || 'ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬');
            }
        } catch(error) {
            showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
        }
    }
    
    function showAlert(type, message) {
        const alertEl = document.getElementById(type === 'success' ? 'alertSuccess' : 'alertError');
        alertEl.textContent = message;
        alertEl.classList.add('show');
        
        setTimeout(() => {
            alertEl.classList.remove('show');
        }, 4000);
    }
    
    window.onclick = function(event) {
        if(event.target.classList.contains('modal')) {
            event.target.classList.remove('active');
        }
    }
</script>
{% endblock %}
