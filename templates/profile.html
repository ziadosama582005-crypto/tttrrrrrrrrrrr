<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø³Ø§Ø¨ÙŠ - Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø±Ù‚Ù…ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(108, 92, 231, 0.3);
        }
        .back-btn {
            background: rgba(108, 92, 231, 0.2);
            border: 1px solid rgba(108, 92, 231, 0.4);
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            text-decoration: none;
        }
        .back-btn:hover {
            background: rgba(108, 92, 231, 0.4);
            transform: scale(1.05);
        }
        .header-title {
            font-size: 24px;
            font-weight: bold;
        }
        .profile-card {
            background: rgba(40, 40, 60, 0.8);
            border: 1px solid rgba(108, 92, 231, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .profile-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(108, 92, 231, 0.2);
            border: 2px solid rgba(108, 92, 231, 0.5);
            overflow: hidden;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-photo.no-image {
            font-size: 50px;
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.3), rgba(100, 200, 255, 0.2));
        }
        .profile-info {
            flex: 1;
        }
        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .profile-id {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 12px;
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
        }
        .profile-balance {
            font-size: 16px;
            color: #6c5ce7;
            font-weight: 600;
        }
        .withdrawal-buttons {
            display: flex;
            flex-direction: row-reverse;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap; 
        }
        .withdraw-btn {
            padding: 12px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 140px;
            max-width: 180px;
            justify-content: center;
            position: relative;
        }
        .withdraw-btn.normal {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
        }
        .withdraw-btn.instant {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
        }
        .withdraw-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .withdraw-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #555;
        }
        .withdraw-btn .fee-badge {
            background: rgba(0,0,0,0.3);
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 4px;
        }
        .withdraw-info {
            margin-top: 10px;
            padding: 10px 15px;
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            font-size: 13px;
            color: #ffc107;
        }
        .withdraw-info.success {
            background: rgba(0, 184, 148, 0.1);
            border-color: rgba(0, 184, 148, 0.3);
            color: #00b894;
        }
        .withdraw-info.frozen {
            background: rgba(99, 179, 237, 0.1);
            border-color: rgba(99, 179, 237, 0.3);
            color: #63b3ed;
        }
        .withdraw-info.frozen .time-left {
            font-size: 11px;
            opacity: 0.8;
        }
        .withdraw-info.instant-info {
            background: rgba(156, 136, 255, 0.1);
            border-color: rgba(156, 136, 255, 0.3);
            color: #9c88ff;
        }
        .recent-charges {
            margin-top: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 12px;
        }
        .charges-title {
            font-size: 13px;
            color: #aaa;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .charge-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 6px;
            font-size: 12px;
        }
        .charge-item:last-child {
            margin-bottom: 0;
        }
        .charge-amount {
            font-weight: 600;
            color: #fff;
        }
        .charge-method {
            color: #888;
            font-size: 11px;
        }
        .charge-status {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        .charge-status.available {
            background: rgba(0, 184, 148, 0.2);
            color: #00b894;
        }
        .charge-status.pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        .withdraw-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .withdraw-modal.active {
            display: flex;
        }
        .withdraw-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(108, 92, 231, 0.3);
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .withdraw-modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(108, 92, 231, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .withdraw-modal-header h2 {
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .withdraw-modal-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.7;
        }
        .withdraw-modal-close:hover {
            opacity: 1;
        }
        .withdraw-modal-body {
            padding: 20px;
        }
        .withdraw-summary {
            background: rgba(108, 92, 231, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .withdraw-summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .withdraw-summary-row:last-child {
            border-bottom: none;
        }
        .withdraw-summary-row.highlight {
            font-weight: bold;
            font-size: 18px;
            color: #00b894;
            padding-top: 12px;
            margin-top: 5px;
            border-top: 2px solid rgba(0, 184, 148, 0.3);
        }
        .withdraw-amounts {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .withdraw-method-select {
            margin-bottom: 20px;
        }
        .method-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .method-option {
            flex: 1;
            padding: 15px;
            background: rgba(50, 50, 70, 0.6);
            border: 2px solid rgba(108, 92, 231, 0.3);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .method-option:hover {
            border-color: rgba(108, 92, 231, 0.6);
        }
        .method-option.selected {
            border-color: #6c5ce7;
            background: rgba(108, 92, 231, 0.2);
        }
        .method-option .icon {
            font-size: 30px;
            margin-bottom: 8px;
        }
        .withdraw-form-group {
            margin-bottom: 15px;
        }
        .withdraw-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: rgba(255,255,255,0.8);
        }
        .withdraw-form-group input,
        .withdraw-form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(50, 50, 70, 0.8);
            border: 1px solid rgba(108, 92, 231, 0.3);
            border-radius: 10px;
            color: #fff;
            font-family: 'Tajawal', sans-serif;
            font-size: 14px;
        }
        .withdraw-form-group input:focus,
        .withdraw-form-group select:focus {
            outline: none;
            border-color: #6c5ce7;
        }
        .withdraw-form-group select option {
            background: #1a1a2e;
        }
        .withdraw-note {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #ffc107;
        }
        .withdraw-submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            font-family: 'Tajawal', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
        }
        .withdraw-submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(108, 92, 231, 0.4);
        }
        .withdraw-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .divider {
            height: 1px;
            background: rgba(108, 92, 231, 0.2);
            margin: 20px 0;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .orders-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .order-card {
            background: rgba(50, 50, 70, 0.6);
            border: 1px solid rgba(108, 92, 231, 0.2);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
        }
        .order-card:hover {
            border-color: rgba(108, 92, 231, 0.5);
            background: rgba(60, 60, 80, 0.8);
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .order-name {
            font-weight: 600;
            font-size: 16px;
        }
        .order-status {
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 6px;
            background: rgba(108, 92, 231, 0.3);
        }
        .order-status.completed {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
        }
        .order-status.failed {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }
        .order-status.pending {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }
        .order-status.refunded {
            background: rgba(33, 150, 243, 0.3);
            color: #2196f3;
        }
        .order-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        .order-price {
            font-weight: 600;
            color: #6c5ce7;
            font-size: 16px;
        }
        .order-date {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
        }
        .empty-state-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }
        .empty-state-text {
            font-size: 16px;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .action-btn {
            flex: 1;
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.4), rgba(100, 200, 255, 0.2));
            border: 1px solid rgba(108, 92, 231, 0.4);
            color: #fff;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .action-btn:hover {
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.6), rgba(100, 200, 255, 0.4));
            border-color: #6c5ce7;
            transform: translateY(-2px);
        }
        .logout-btn {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(244, 67, 54, 0.1));
            border: 1px solid rgba(244, 67, 54, 0.4);
            color: #ff6b6b;
        }
        .logout-btn:hover {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.5), rgba(244, 67, 54, 0.3));
            border-color: #f44336;
        }
        @media (max-width: 600px) {
            .profile-card {
                padding: 20px;
            }
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            .profile-photo {
                width: 80px;
                height: 80px;
            }
            .order-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .action-buttons {
                flex-direction: column;
            }
        }
        .security-section {
            margin-top: 20px;
        }
        .security-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px;
            background: rgba(50, 50, 70, 0.6);
            border: 1px solid rgba(108, 92, 231, 0.2);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }
        .security-item:hover {
            border-color: rgba(108, 92, 231, 0.5);
            background: rgba(60, 60, 80, 0.8);
        }
        .security-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .security-icon {
            font-size: 28px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(108, 92, 231, 0.2);
            border-radius: 12px;
        }
        .security-text h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .security-text p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }
        .security-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        .status-badge.verified {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.4);
        }
        .status-badge.not-verified {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.4);
        }
        .status-badge.disabled {
            background: rgba(158, 158, 158, 0.2);
            color: #9e9e9e;
            border: 1px solid rgba(158, 158, 158, 0.4);
        }
        .security-btn {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            border: none;
            color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .security-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }
        .security-btn.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: flex-end;
            justify-content: center;
            padding: 0;
            overflow-y: auto;
        }
        .modal-overlay.show {
            display: flex;
        }
        .modal-content {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(108, 92, 231, 0.3);
            border-radius: 25px 25px 0 0;
            max-width: 100%;
            width: 100%;
            padding: 25px 20px;
            padding-bottom: 40px;
            animation: modalSlideUp 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(100%);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @media (min-width: 601px) {
            .modal-overlay {
                align-items: center;
                padding: 20px;
            }
            .modal-content {
                max-width: 450px;
                border-radius: 20px;
                padding: 30px;
                max-height: 85vh;
                animation: modalSlide 0.3s ease;
            }
            @keyframes modalSlide {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        }
        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            font-size: 20px;
            margin-top: 10px;
        }
        .modal-header p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin-top: 8px;
            line-height: 1.5;
        }
        .modal-header span {
            font-size: 40px;
        }
        .modal-body {
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }
        .form-group input {
            width: 100%;
            padding: 14px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(108, 92, 231, 0.3);
            border-radius: 12px;
            color: #fff;
            font-size: 18px;
        }
        .form-group input:focus {
            outline: none;
            border-color: #6c5ce7;
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.2);
        }
        .qr-container {
            text-align: center;
            padding: 15px;
            background: #fff;
            border-radius: 15px;
            margin: 15px 0;
        }
        .qr-container img {
            max-width: 180px;
            width: 100%;
        }
        .secret-key {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            text-align: center;
            margin: 12px 0;
            word-break: break-all;
            border: 1px dashed rgba(108, 92, 231, 0.5);
            line-height: 1.6;
        }
        .modal-actions {
            display: flex;
            gap: 10px;
            flex-direction: column-reverse;
        }
        @media (min-width: 601px) {
            .modal-actions {
                flex-direction: row;
            }
        }
        .modal-actions button {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 50px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            border: none;
            color: #fff;
        }
        .btn-primary:active {
            transform: scale(0.98);
        }
        .btn-secondary {
            background: rgba(108, 92, 231, 0.2);
            border: 1px solid rgba(108, 92, 231, 0.4);
            color: #fff;
        }
        @media (max-width: 600px) {
            .security-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .security-status {
                width: 100%;
                justify-content: flex-end;
            }
            .security-btn {
                padding: 12px 25px;
            }
            .security-icon {
                width: 45px;
                height: 45px;
                font-size: 24px;
            }
            .info-box {
                padding: 12px;
            }
            .info-box ol {
                margin-right: 15px;
                font-size: 12px;
            }
        }
        .info-box {
            background: rgba(108, 92, 231, 0.1);
            border: 1px solid rgba(108, 92, 231, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 12px 0;
        }
        .info-box h4 {
            font-size: 13px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-box ol {
            margin-right: 20px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.8;
        }
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }
        .alert.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
            color: #4caf50;
            display: block;
        }
        .alert.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.4);
            color: #f44336;
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/" class="back-btn" title="Ø§Ù„Ø¹ÙˆØ¯Ø©">â†</a>
            <h1 class="header-title"> Ø­Ø³Ø§Ø¨ÙŠ</h1>
        </div>
        <div class="profile-card">
            <div class="profile-header">
                <div class="profile-photo {% if not profile_photo %}no-image{% endif %}">
                    {% if profile_photo %}
                        <img src="{{ profile_photo }}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„">
                    {% else %}
                    {% endif %}
                </div>
                <div class="profile-info">
                    <div class="profile-name">{{ user_name }}</div>
                    <div class="profile-id">ID: {{ user_id }}</div>
                    <div class="profile-balance"> Ø§Ù„Ø±ØµÙŠØ¯: {{ "%.2f"|format(balance) }} Ø±.Ø³</div>
                    <div class="withdrawal-buttons">
                        <button class="withdraw-btn normal" 
                                onclick="openWithdrawModal('normal')"
                                {% if normal_withdraw_amount <= 0 %}disabled{% endif %}
                                title="{% if normal_withdraw_amount <= 0 %}Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯ Ù…ØªØ§Ø­ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠ{% endif %}">
                             Ø¹Ø§Ø¯ÙŠ
                            <span class="fee-badge">6.5%</span>
                        </button>
                        <button class="withdraw-btn instant" 
                                onclick="openWithdrawModal('instant')"
                                {% if balance <= 0 %}disabled{% endif %}
                                title="{% if balance <= 0 %}Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯{% endif %}">
                             ÙÙˆØ±ÙŠ
                            <span class="fee-badge">8%</span>
                        </button>
                    </div>
                    {% if balance > 0 %}
                    <div class="withdraw-amounts">
                        <div class="withdraw-info success">
                             Ù…ØªØ§Ø­ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠ: {{ "%.2f"|format(normal_withdraw_amount) }} Ø±.Ø³
                        </div>
                        {% if frozen_balance > 0 %}
                        <div class="withdraw-info frozen">
                             <b>Ø±ØµÙŠØ¯ Ù…Ø¬Ù…Ø¯ Ù…Ø¤Ù‚ØªØ§Ù‹:</b> {{ "%.2f"|format(frozen_balance) }} Ø±.Ø³
                            <br>
                            {% if min_minutes_left > 0 %}
                            <small>â³ ÙŠØµØ¨Ø­ Ù…ØªØ§Ø­Ø§Ù‹ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ø¨Ø¹Ø¯: {{ min_minutes_left }} Ø¯Ù‚ÙŠÙ‚Ø©</small>
                            {% endif %}
                        </div>
                        {% endif %}
                        <div class="withdraw-info instant-info">
                             Ù…ØªØ§Ø­ Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„ÙÙˆØ±ÙŠ: {{ "%.2f"|format(balance) }} Ø±.Ø³
                        </div>
                        {% if recent_charges %}
                        <div class="recent-charges">
                            <div class="charges-title"> Ø¢Ø®Ø± Ø§Ù„Ø´Ø­Ù†Ø§Øª:</div>
                            {% for charge in recent_charges %}
                            <div class="charge-item {% if charge.is_available %}available{% else %}pending{% endif %}">
                                <span class="charge-amount">{{ "%.2f"|format(charge.amount) }} Ø±.Ø³</span>
                                <span class="charge-method">{{ charge.method }}</span>
                                {% if charge.is_available %}
                                <span class="charge-status available"> Ù…ØªØ§Ø­</span>
                                {% else %}
                                <span class="charge-status pending"> {{ charge.minutes_left }} Ø¯</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="divider"></div>
            <h2 class="section-title"> Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚</h2>
            <div class="security-section">
                <div class="security-item">
                    <div class="security-item-info">
                        <div class="security-icon"></div>
                        <div class="security-text">
                            <h3>ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h3>
                            <p>{% if email %}{{ email }}{% else %}Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ{% endif %}</p>
                        </div>
                    </div>
                    <div class="security-status">
                        {% if email_verified %}
                            <span class="status-badge verified">âœ“ Ù…ÙˆØ«Ù‚</span>
                        {% else %}
                            <button class="security-btn" onclick="openEmailModal()">
                                {% if email %}ØªÙˆØ«ÙŠÙ‚{% else %}Ø¥Ø¶Ø§ÙØ©{% endif %}
                            </button>
                        {% endif %}
                    </div>
                </div>
                <div class="security-item">
                    <div class="security-item-info">
                        <div class="security-icon"></div>
                        <div class="security-text">
                            <h3>Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (2FA)</h3>
                            <p>Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ø¨Ø± Google Authenticator</p>
                        </div>
                    </div>
                    <div class="security-status">
                        {% if totp_enabled %}
                            <span class="status-badge verified">âœ“ Ù…ÙØ¹Ù‘Ù„</span>
                            <button class="security-btn danger" onclick="openDisable2FAModal()">ØªØ¹Ø·ÙŠÙ„</button>
                        {% else %}
                            <button class="security-btn" onclick="openSetup2FAModal()">ØªÙØ¹ÙŠÙ„</button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="profile-card">
            <h2 class="section-title"> Ø¢Ø®Ø± 3 Ø·Ù„Ø¨Ø§Øª</h2>
            {% if orders %}
                <div class="orders-list">
                    {% for order in orders %}
                        <div class="order-card">
                            <div class="order-header">
                                <div class="order-name">{{ order.product_name }}</div>
                                <div class="order-status {{ order.status }}">
                                    {{ order.status_ar }}
                                </div>
                            </div>
                            <div class="order-details">
                                <div>
                                    <div class="order-price">{{ "%.2f"|format(order.total) }} Ø±.Ø³</div>
                                </div>
                                <div>
                                    <div class="order-date"> {{ order.date_formatted }}</div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</div>
                </div>
            {% endif %}
        </div>
        <div class="action-buttons" style="margin-top: 30px;">
            <button class="action-btn logout-btn" onclick="logout()">
                 ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </div>
    <script>
        function logout() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                fetch('/logout', {method: 'POST'})
                    .then(() => {
                        localStorage.removeItem('user_logged_in');
                        location.href = '/';
                    })
                    .catch(error => {
                        localStorage.removeItem('user_logged_in');
                        location.href = '/';
                    });
            }
        }
        function openEmailModal() {
            document.getElementById('emailModal').classList.add('show');
        }
        function closeEmailModal() {
            document.getElementById('emailModal').classList.remove('show');
            document.getElementById('emailError').style.display = 'none';
            document.getElementById('emailSuccess').style.display = 'none';
            document.getElementById('emailStep1').style.display = 'block';
            document.getElementById('emailStep2').style.display = 'none';
            document.getElementById('emailStep1Btn').style.display = 'block';
            document.getElementById('emailStep2Btn').style.display = 'none';
            document.getElementById('emailInput').value = '';
            document.getElementById('emailCodeInput').value = '';
        }
        async function sendEmailCode() {
            const email = document.getElementById('emailInput').value.trim();
            const btn = event.target;
            const errorDiv = document.getElementById('emailError');
            const successDiv = document.getElementById('emailSuccess');
            if (!email || !email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                errorDiv.textContent = ' Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­';
                errorDiv.style.display = 'block';
                return;
            }
            btn.disabled = true;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            errorDiv.style.display = 'none';
            try {
                const response = await fetch('/api/send_email_code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                });
                const data = await response.json();
                if (data.success) {
                    successDiv.textContent = ' ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Telegram';
                    successDiv.style.display = 'block';
                    document.getElementById('emailStep1').style.display = 'none';
                    document.getElementById('emailStep2').style.display = 'block';
                    document.getElementById('emailStep1Btn').style.display = 'none';
                    document.getElementById('emailStep2Btn').style.display = 'block';
                } else {
                    errorDiv.textContent = ` ${data.message}`;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = ' Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±';
                errorDiv.style.display = 'block';
            }
            btn.disabled = false;
            btn.textContent = 'Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚';
        }
        async function verifyEmailCode() {
            const code = document.getElementById('emailCodeInput').value.trim();
            const btn = event.target;
            const errorDiv = document.getElementById('emailError');
            if (!code || code.length !== 6) {
                errorDiv.textContent = ' Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…';
                errorDiv.style.display = 'block';
                return;
            }
            btn.disabled = true;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            errorDiv.style.display = 'none';
            try {
                const response = await fetch('/api/verify_email_code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
                const data = await response.json();
                if (data.success) {
                    alert(' ØªÙ… ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
                    location.reload();
                } else {
                    errorDiv.textContent = ` ${data.message}`;
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = ' Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±';
                errorDiv.style.display = 'block';
            }
            btn.disabled = false;
            btn.textContent = 'ØªØ£ÙƒÙŠØ¯';
        }
        async function openSetup2FAModal() {
            const modal = document.getElementById('setup2FAModal');
            const loading = document.getElementById('2faLoading');
            const content = document.getElementById('2faContent');
            modal.classList.add('show');
            loading.style.display = 'block';
            content.style.display = 'none';
            try {
                const response = await fetch('/api/setup_2fa', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const data = await response.json();
                if (data.success) {
                    document.getElementById('qrCodeImg').src = data.qr_code;
                    document.getElementById('secretKey').textContent = data.secret;
                    loading.style.display = 'none';
                    content.style.display = 'block';
                } else {
                    alert(' ' + data.message);
                    modal.classList.remove('show');
                }
            } catch (error) {
                alert(' Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
                modal.classList.remove('show');
            }
        }
        function closeSetup2FAModal() {
            document.getElementById('setup2FAModal').classList.remove('show');
            document.getElementById('2faError').style.display = 'none';
        }
        async function verify2FASetup() {
            const code = document.getElementById('totpCode').value.trim();
            const btn = event.target;
            const errorDiv = document.getElementById('2faError');
            if (!code || code.length !== 6) {
                errorDiv.textContent = ' Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…';
                errorDiv.className = 'alert error';
                return;
            }
            btn.disabled = true;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            errorDiv.style.display = 'none';
            try {
                const response = await fetch('/api/verify_2fa_setup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
                const data = await response.json();
                if (data.success) {
                    alert(' ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
                    location.reload();
                } else {
                    errorDiv.textContent = ` ${data.message}`;
                    errorDiv.className = 'alert error';
                }
            } catch (error) {
                errorDiv.textContent = ' Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±';
                errorDiv.className = 'alert error';
            }
            btn.disabled = false;
            btn.textContent = 'ØªÙØ¹ÙŠÙ„';
        }
        function copySecret() {
            const secret = document.getElementById('secretKey').textContent;
            navigator.clipboard.writeText(secret).then(() => {
                alert(' ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ');
            });
        }
        function openDisable2FAModal() {
            document.getElementById('disable2FAModal').classList.add('show');
        }
        function closeDisable2FAModal() {
            document.getElementById('disable2FAModal').classList.remove('show');
        }
        async function disable2FA() {
            const code = document.getElementById('disableCode').value.trim();
            const btn = event.target;
            const errorDiv = document.getElementById('disable2faError');
            if (!code || code.length !== 6) {
                errorDiv.textContent = ' Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…';
                errorDiv.className = 'alert error';
                return;
            }
            btn.disabled = true;
            btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø·ÙŠÙ„...';
            try {
                const response = await fetch('/api/disable_2fa', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code })
                });
                const data = await response.json();
                if (data.success) {
                    alert(' ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©');
                    location.reload();
                } else {
                    errorDiv.textContent = ` ${data.message}`;
                    errorDiv.className = 'alert error';
                }
            } catch (error) {
                errorDiv.textContent = ' Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±';
                errorDiv.className = 'alert error';
            }
            btn.disabled = false;
            btn.textContent = 'ØªØ¹Ø·ÙŠÙ„';
        }
    </script>
    <div class="modal-overlay" id="emailModal">
        <div class="modal-content">
            <div class="modal-header">
                <span style="font-size: 50px;"></span>
                <h2>ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
                <p>Ø£Ø¶Ù Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„ØªØ£Ù…ÙŠÙ† Ø­Ø³Ø§Ø¨Ùƒ</p>
            </div>
            <div id="emailError" class="alert"></div>
            <div id="emailSuccess" class="alert"></div>
            <div class="modal-body">
                <div id="emailStep1">
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="emailInput" placeholder="example@email.com">
                    </div>
                </div>
                <div id="emailStep2" style="display: none;">
                    <div class="form-group">
                        <label>ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ (6 Ø£Ø±Ù‚Ø§Ù…)</label>
                        <input type="text" id="emailCodeInput" placeholder="000000" maxlength="6" style="text-align: center; letter-spacing: 8px; font-size: 20px;">
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeEmailModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-primary" id="emailStep1Btn" onclick="sendEmailCode()">Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</button>
                <button class="btn-primary" id="emailStep2Btn" onclick="verifyEmailCode()" style="display: none;">ØªØ£ÙƒÙŠØ¯</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="setup2FAModal">
        <div class="modal-content">
            <div class="modal-header">
                <span style="font-size: 50px;"></span>
                <h2>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©</h2>
                <p>Ø§Ø³ØªØ®Ø¯Ù… Google Authenticator Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ</p>
            </div>
            <div id="2faLoading" style="text-align: center; padding: 30px;">
                â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
            </div>
            <div id="2faContent" style="display: none;">
                <div class="info-box">
                    <h4> Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙØ¹ÙŠÙ„:</h4>
                    <ol>
                        <li>Ø­Ù…Ù‘Ù„ ØªØ·Ø¨ÙŠÙ‚ Google Authenticator</li>
                        <li>Ø§Ù…Ø³Ø­ Ø±Ù…Ø² QR Ø£Ø¯Ù†Ø§Ù‡ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…ÙØªØ§Ø­ ÙŠØ¯ÙˆÙŠØ§Ù‹</li>
                        <li>Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…</li>
                    </ol>
                </div>
                <div class="qr-container">
                    <img id="qrCodeImg" src="" alt="QR Code">
                </div>
                <div class="secret-key" onclick="copySecret()" style="cursor: pointer;" title="Ø§Ù†Ù‚Ø± Ù„Ù„Ù†Ø³Ø®">
                    <span id="secretKey"></span>
                    <br><small style="color: #6c5ce7;"> Ø§Ù†Ù‚Ø± Ù„Ù„Ù†Ø³Ø®</small>
                </div>
                <div id="2faError" class="alert"></div>
                <div class="form-group">
                    <label>ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
                    <input type="text" id="totpCode" placeholder="000000" maxlength="6" style="text-align: center; letter-spacing: 8px; font-size: 20px;">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeSetup2FAModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-primary" onclick="verify2FASetup()">ØªÙØ¹ÙŠÙ„</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="disable2FAModal">
        <div class="modal-content">
            <div class="modal-header">
                <span style="font-size: 50px;"></span>
                <h2>ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©</h2>
                <p>Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ Authenticator Ù„Ù„ØªØ£ÙƒÙŠØ¯</p>
            </div>
            <div id="disable2faError" class="alert"></div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚</label>
                    <input type="text" id="disableCode" placeholder="000000" maxlength="6" style="text-align: center; letter-spacing: 8px; font-size: 20px;">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeDisable2FAModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-primary" style="background: linear-gradient(135deg, #e74c3c, #c0392b);" onclick="disable2FA()">ØªØ¹Ø·ÙŠÙ„</button>
            </div>
        </div>
    </div>
    <div class="withdraw-modal" id="withdrawModal">
        <div class="withdraw-modal-content">
            <div class="withdraw-modal-header">
                <h2 id="withdrawModalTitle"> Ø·Ù„Ø¨ Ø³Ø­Ø¨</h2>
                <button class="withdraw-modal-close" onclick="closeWithdrawModal()">Ã—</button>
            </div>
            <div class="withdraw-modal-body">
                <div class="withdraw-summary">
                    <div class="withdraw-summary-row">
                        <span>Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù„Ø³Ø­Ø¨:</span>
                        <span id="withdrawBalance">0 Ø±.Ø³</span>
                    </div>
                    <div class="withdraw-summary-row">
                        <span>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø­Ø¨:</span>
                        <span id="withdrawType">-</span>
                    </div>
                    <div class="withdraw-summary-row">
                        <span>Ø§Ù„Ø±Ø³ÙˆÙ… (<span id="feePercent">0</span>%):</span>
                        <span id="withdrawFee">0 Ø±.Ø³</span>
                    </div>
                    <div class="withdraw-summary-row highlight">
                        <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ØµØ§ÙÙŠ:</span>
                        <span id="withdrawNet">0 Ø±.Ø³</span>
                    </div>
                </div>
                <div class="withdraw-method-select">
                    <label>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨:</label>
                    <div class="method-options">
                        <div class="method-option" onclick="selectMethod('wallet')" id="methodWallet">
                            <div class="icon"></div>
                            <div>Ù…Ø­ÙØ¸Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</div>
                        </div>
                        <div class="method-option" onclick="selectMethod('bank')" id="methodBank">
                            <div class="icon">ğŸ¦</div>
                            <div>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</div>
                        </div>
                    </div>
                </div>
                <div id="walletForm" style="display: none;">
                    <div class="withdraw-form-group">
                        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
                        <input type="text" id="walletFullName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ">
                    </div>
                    <div class="withdraw-form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙØ¸Ø©</label>
                        <input type="text" id="walletType" placeholder="Ù…Ø«Ø§Ù„: STC Pay, URPay, Alinma Pay...">
                    </div>
                    <div class="withdraw-form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ø­ÙØ¸Ø©</label>
                        <input type="text" id="walletNumber" placeholder="05XXXXXXXX">
                    </div>
                    <div class="withdraw-note">
                         Ø³ÙŠØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø®Ù„Ø§Ù„ 12-24 Ø³Ø§Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨
                    </div>
                </div>
                <div id="bankForm" style="display: none;">
                    <div class="withdraw-form-group">
                        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ)</label>
                        <input type="text" id="bankFullName" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ ÙŠØ¸Ù‡Ø± ÙÙŠ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨">
                    </div>
                    <div class="withdraw-form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label>
                        <input type="text" id="bankName" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠØŒ Ø§Ù„Ø£Ù‡Ù„ÙŠØŒ Ø§Ù„Ø¥Ù†Ù…Ø§Ø¡...">
                    </div>
                    <div class="withdraw-form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† (IBAN)</label>
                        <input type="text" id="bankIban" placeholder="SA0000000000000000000000" maxlength="24" style="text-transform: uppercase;">
                    </div>
                    <div class="withdraw-note">
                         Ø³ÙŠØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø®Ù„Ø§Ù„ 12-24 Ø³Ø§Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨
                    </div>
                </div>
                <button class="withdraw-submit-btn" onclick="submitWithdraw()" id="submitWithdrawBtn" disabled>
                     ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨
                </button>
            </div>
        </div>
    </div>
    <script>
        let currentWithdrawType = '';
        let currentMethod = '';
        let currentAmount = 0;
        const userBalance = parseFloat("{{ balance }}") || 0;
        const normalAmount = parseFloat("{{ normal_withdraw_amount }}") || 0;
        const instantAmount = parseFloat("{{ instant_withdraw_amount }}") || 0;
        function openWithdrawModal(type) {
            currentWithdrawType = type;
            const modal = document.getElementById('withdrawModal');
            const title = document.getElementById('withdrawModalTitle');
            const typeSpan = document.getElementById('withdrawType');
            const feePercent = document.getElementById('feePercent');
            const withdrawFee = document.getElementById('withdrawFee');
            const withdrawNet = document.getElementById('withdrawNet');
            currentAmount = type === 'normal' ? normalAmount : instantAmount;
            const fee = type === 'normal' ? 6.5 : 8;
            const feeAmount = currentAmount * (fee / 100);
            const netAmount = currentAmount - feeAmount;
            title.textContent = type === 'normal' ? ' Ø³Ø­Ø¨ Ø¹Ø§Ø¯ÙŠ' : ' Ø³Ø­Ø¨ ÙÙˆØ±ÙŠ';
            typeSpan.textContent = type === 'normal' ? 'Ø¹Ø§Ø¯ÙŠ (6.5%)' : 'ÙÙˆØ±ÙŠ (8%)';
            document.getElementById('withdrawBalance').textContent = currentAmount.toFixed(2) + ' Ø±.Ø³';
            feePercent.textContent = fee;
            withdrawFee.textContent = feeAmount.toFixed(2) + ' Ø±.Ø³';
            withdrawNet.textContent = netAmount.toFixed(2) + ' Ø±.Ø³';
            currentMethod = '';
            document.getElementById('methodWallet').classList.remove('selected');
            document.getElementById('methodBank').classList.remove('selected');
            document.getElementById('walletForm').style.display = 'none';
            document.getElementById('bankForm').style.display = 'none';
            document.getElementById('submitWithdrawBtn').disabled = true;
            modal.classList.add('active');
        }
        function closeWithdrawModal() {
            document.getElementById('withdrawModal').classList.remove('active');
        }
        function selectMethod(method) {
            currentMethod = method;
            document.getElementById('methodWallet').classList.toggle('selected', method === 'wallet');
            document.getElementById('methodBank').classList.toggle('selected', method === 'bank');
            document.getElementById('walletForm').style.display = method === 'wallet' ? 'block' : 'none';
            document.getElementById('bankForm').style.display = method === 'bank' ? 'block' : 'none';
            document.getElementById('submitWithdrawBtn').disabled = false;
        }
        async function submitWithdraw() {
            const btn = document.getElementById('submitWithdrawBtn');
            btn.disabled = true;
            btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
            let data = {
                type: currentWithdrawType,
                method: currentMethod,
                amount: currentAmount 
            };
            if (currentMethod === 'wallet') {
                data.full_name = document.getElementById('walletFullName').value.trim();
                data.wallet_type = document.getElementById('walletType').value;
                data.wallet_number = document.getElementById('walletNumber').value.trim();
                if (!data.full_name || !data.wallet_type || !data.wallet_number) {
                    alert(' Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                    btn.disabled = false;
                    btn.textContent = ' ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨';
                    return;
                }
            } else {
                data.full_name = document.getElementById('bankFullName').value.trim();
                data.bank_name = document.getElementById('bankName').value.trim();
                data.iban = document.getElementById('bankIban').value.trim().toUpperCase();
                if (!data.full_name || !data.bank_name || !data.iban) {
                    alert(' Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                    btn.disabled = false;
                    btn.textContent = ' ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨';
                    return;
                }
                if (!data.iban.startsWith('SA') || data.iban.length !== 24) {
                    alert(' Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ¨Ø§Ù† ØºÙŠØ± ØµØ­ÙŠØ­ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø¨Ù€ SA ÙˆÙŠØªÙƒÙˆÙ† Ù…Ù† 24 Ø­Ø±Ù)');
                    btn.disabled = false;
                    btn.textContent = ' ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨';
                    return;
                }
            }
            try {
                const response = await fetch('/api/withdraw', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    alert(' ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­!\n\nØ³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ø®Ù„Ø§Ù„ 12-24 Ø³Ø§Ø¹Ø©.');
                    closeWithdrawModal();
                    location.reload();
                } else {
                    alert(' ' + result.message);
                }
            } catch (error) {
                alert(' Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
            }
            btn.disabled = false;
            btn.textContent = ' ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨';
        }
    </script>
